#!/bin/bash
N_dir="$(grep POSCAR ../aflow_sym/uniq_poscar_list | tail -1 | awk '{print $1 }')"
for i in $(seq 1 ${N_dir}) ; do at_ratio="$( echo "scale=6; $(sed -n 7p $i/Relax/POSCAR | awk '{printf $2}') / $( expr $(sed -n 7p $i/Relax/POSCAR | awk '{printf $1}') + $(sed -n 7p $i/Relax/POSCAR | awk '{printf $2}') ) " | bc -l )" ; if grep -q "enthalpy is  TOTEN    =" $i/Relax/OUTCAR ; then e_final="$( echo "scale=6; $(grep "enthalpy is  TOTEN    =" $i/Relax/OUTCAR | tail -1 | awk '{printf "%.6f", $5 }') / $(grep "NIONS =" $i/Relax/OUTCAR | awk '{printf $12}' ) " | bc -l )" ; else e_final="$( echo "scale=6; $(grep "free energy    TOTEN  =" $i/Relax/OUTCAR | tail -1 | awk '{printf "%.6f", $5 }') / $(grep "NIONS =" $i/Relax/OUTCAR | awk '{printf $12}' ) " | bc -l )" ; fi ; echo $i $at_ratio $e_final ; done > convex_hull.dat
